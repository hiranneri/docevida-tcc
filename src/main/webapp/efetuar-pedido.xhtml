<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	  xmlns:p="http://primefaces.org/ui">
	<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
	
<h:head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Efetuar Pedido</title>
</h:head>
<h:body>
    <h3>Pedido</h3>
    
 <h:form id="form">
   
    <h:outputText value="Data do Pedido"/>
    <!-- Pegar data/hora do sistema--> 
    <h:outputText value="#{EfetuarPedidoBean.strDataAtual}"></h:outputText>
    <br></br>
    <br></br>
    <p:outputLabel for="dataEntrega" value="Data da Entrega:" />
    <p:calendar id="dataEntrega" value="#{EfetuarPedidoBean.dataDaEntrega}" mindate="#{EfetuarPedidoBean.dataAtual}"
    	required="true" />
    <br></br>
    <br></br>
        
    		<h:outputText value="Cliente: "></h:outputText>
    		<h:outputText value="#{EfetuarPedidoBean.cliente.nome}" id="cliente" ></h:outputText>
    		<p:commandButton icon="ui-icon-search" title="Pesquisar Clientes" 
 				action="#{EfetuarPedidoBean.abrirDialogo}" process="@this">
	 			
	 			<p:ajax event="dialogReturn" listener="#{EfetuarPedidoBean.clienteSelecionado}" 
	 			process="@this" update="cliente" />	
    		</p:commandButton>
    	 <br></br>
    <br></br>
    <h:panelGroup id="panelProduto">
        <!--Produto -->
        <p:outputLabel for="produto" value="Produto:"></p:outputLabel>
         <h:inputText id="produto" value="#{EfetuarPedidoBean.produto.nmProduto}" 
         rendered="#{EfetuarPedidoBean.produto!=null}" 
         >
       	 </h:inputText>
       	 
       	 <p:spinner id="ajaxSpinner" value="#{EfetuarPedidoBean.quantidadeDoItem}" min="1" 
       	 rendered="#{EfetuarPedidoBean.produto!=null}" >
             
         </p:spinner>
            
        
        <!-- Botão buscar produto-->
        
        	<p:growl id="growlProduto" showDetail="true" />
 			<p:commandButton icon="ui-icon-search" title="Pesquisar Produtos" 
 			action="#{EfetuarPedidoBean.abrirDialogoProduto}" process="@this" update="panelProduto">
	 			<p:ajax event="dialogReturn" listener="#{EfetuarPedidoBean.produtoSelecionado}" 
	 			process="@this" update="panelProduto" />								
    			
    		</p:commandButton>
    	
       <!-- Botão Adicionar na Tabela -->
       <p:commandButton icon="ui-icon-plusthick" title="Adicionar Item" 
       actionListener="#{EfetuarPedidoBean.adicionarItems}"  value="Adicionar" 
       update="tblProdutos" ajax="false" rendered="#{EfetuarPedidoBean.produto!=null}"  >
       </p:commandButton>
       </h:panelGroup>     		
        <br></br>
        <br></br>
      
        <p:dataTable value="#{EfetuarPedidoBean.pedido.itensDoPedido}" var="item" dynamic="true" 
        id="tblProdutos" emptyMessage="Nenhum Produto Adicionado"  rows="15" paginator="true" 
        paginatorAlwaysVisible="false" paginatorPosition="bottom">
        
	  		<p:column headerText="Mercadoria">
	  			<h:outputText value="#{item.produto.nmProduto}"></h:outputText>
	  		</p:column>
	  		<p:column headerText="Quantidade">
	  			<h:outputText value="#{item.quantidade}"></h:outputText>
	  		</p:column>
	  		<p:column headerText="Valor Unitário" styleClass="column-money">
                 <h:outputText value="#{item.produto.valorUnitario}"/>
            </p:column>
             
            <p:column headerText="Subtotal">
                  <h:outputText value="#{item.subTotal}"  />
             </p:column>     
          
             <p:column headerText="Ação">
            	<p:commandButton icon="ui-icon-trash" title="Excluir Item" action="#{EfetuarPedidoBean.excluirItem(item)}" 
                	process="@this" update="tblProdutos"></p:commandButton>
            </p:column>
           
            
  	</p:dataTable>
  	<br></br>
    <br></br>
    <h:outputText value="Valor Total: R$ "></h:outputText>
    <h:outputText value="#{EfetuarPedidoBean.pedido.valorTotal}"></h:outputText>
    <br></br>
    <br></br>	
    <p:commandButton value="Salvar Pedido"  icon="ui-icon-check" action="#{EfetuarPedidoBean.confirmarPedido}" 
    	rendered="#{EfetuarPedidoBean.pedido.valorTotal !=0}"/>
 	<p:commandButton value="Cancelar"  icon="ui-icon-check" action="#{EfetuarPedidoBean.cancelarPedido}" />
    </h:form>
		 
    
</h:body>
</ui:composition>
</html>